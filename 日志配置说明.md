# 日志配置说明

## 日志文件位置

应用启动后，日志文件会生成在以下位置：

### 开发环境（本地）
- 日志目录：项目根目录下的 `logs/` 文件夹
- 应用日志：`logs/test-api.log`
- 错误日志：`logs/test-api-error.log`

### 生产环境（服务器）
- 日志目录：`/opt/test-api/logs/`
- 应用日志：`/opt/test-api/logs/test-api.log`
- 错误日志：`/opt/test-api/logs/test-api-error.log`
- 启动日志：`/opt/test-api/logs/startup.log`

## 日志文件说明

### 1. test-api.log
- **说明**：应用的主要日志文件，包含所有级别的日志（INFO、DEBUG、WARN、ERROR）
- **格式**：按日期滚动，每天一个文件，格式为 `test-api-2024-01-01.0.log`
- **大小限制**：单个文件最大 10MB，超过后自动滚动
- **保留时间**：保留最近 30 天的日志
- **总大小限制**：所有日志文件总大小不超过 1GB

### 2. test-api-error.log
- **说明**：只包含 ERROR 级别的日志，方便快速定位错误
- **格式**：按日期滚动，格式为 `test-api-error-2024-01-01.0.log`
- **大小限制**：单个文件最大 10MB
- **保留时间**：保留最近 30 天
- **总大小限制**：所有错误日志总大小不超过 500MB

### 3. startup.log
- **说明**：应用启动时的控制台输出日志
- **用途**：记录启动过程中的输出信息

## 日志格式

日志格式统一为：
```
2024-01-01 12:00:00.123 [main] INFO  org.lyf.testapi.controller.GameController - 接口调用信息
```

格式说明：
- `2024-01-01 12:00:00.123`：时间戳（精确到毫秒）
- `[main]`：线程名
- `INFO`：日志级别
- `org.lyf.testapi.controller.GameController`：类名（最多显示50个字符）
- `接口调用信息`：日志内容

## 日志级别

### 开发环境
- **应用代码**：DEBUG 级别（详细调试信息）
- **MyBatis SQL**：DEBUG 级别（显示 SQL 语句）
- **Spring 框架**：INFO 级别
- **根日志**：INFO 级别

### 生产环境
- **应用代码**：INFO 级别（只记录重要信息）
- **MyBatis SQL**：不输出（减少日志量）
- **Spring 框架**：INFO 级别
- **根日志**：INFO 级别
- **控制台输出**：关闭（只输出到文件）

## 查看日志命令

### 实时查看日志
```bash
# 查看应用日志
tail -f /opt/test-api/logs/test-api.log

# 查看错误日志
tail -f /opt/test-api/logs/test-api-error.log

# 查看启动日志
tail -f /opt/test-api/logs/startup.log
```

### 查看最近的日志
```bash
# 查看最后 100 行
tail -n 100 /opt/test-api/logs/test-api.log

# 查看包含关键字的日志
grep "接口调用" /opt/test-api/logs/test-api.log

# 查看今天的错误日志
grep "ERROR" /opt/test-api/logs/test-api-error.log
```

### 查看历史日志
```bash
# 查看指定日期的日志
cat /opt/test-api/logs/test-api-2024-01-01.0.log

# 查看所有日志文件
ls -lh /opt/test-api/logs/
```

## 日志配置位置

### 配置文件
- **Logback 配置**：`src/main/resources/logback-spring.xml`
- **应用配置**：`src/main/resources/application-prod.properties`

### 配置说明
- 日志路径可以通过系统属性 `LOG_HOME` 设置
- 启动脚本会自动设置日志目录
- 生产环境会自动创建日志目录

## 日志轮转规则

1. **按时间滚动**：每天生成新的日志文件
2. **按大小滚动**：单个文件超过 10MB 时，自动创建新文件
3. **文件命名**：`test-api-2024-01-01.0.log`、`test-api-2024-01-01.1.log` 等
4. **自动清理**：超过 30 天的日志文件会自动删除
5. **大小限制**：总大小超过限制时，删除最旧的日志文件

## 注意事项

1. **日志目录权限**：确保应用有权限在日志目录中创建和写入文件
2. **磁盘空间**：定期检查日志目录的磁盘使用情况，避免磁盘空间不足
3. **日志级别**：生产环境建议使用 INFO 级别，减少日志量
4. **敏感信息**：不要在日志中输出密码、token 等敏感信息
5. **日志备份**：重要日志建议定期备份到其他位置

## 常见问题

### 1. 日志文件没有生成
- 检查日志目录是否存在且有写权限
- 检查应用是否正常启动
- 查看启动日志 `startup.log` 是否有错误

### 2. 日志文件过大
- 检查日志级别是否设置过低（DEBUG 会产生大量日志）
- 检查是否有异常循环导致大量错误日志
- 考虑调整日志保留时间和大小限制

### 3. 找不到日志文件
- 确认日志目录路径是否正确
- 检查系统属性 `LOG_HOME` 是否设置
- 查看应用启动时的日志目录输出

### 4. 日志格式乱码
- 确保日志文件编码为 UTF-8
- 检查终端编码设置

